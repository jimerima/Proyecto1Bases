{% extends "base.html" %}

{% block titulo %}Consultar miembros por club{% endblock %}

{% block contenido %}
  <div class="hero" style="text-align:center; padding-top: 2rem;">
    <div class="col" style="margin:auto; max-width:920px; text-align:left;">
      <div class="eyebrow" style="font-weight: bold; color:#000;">Consultas</div>
      <h1>Consultar miembros por club</h1>
      <p class="lead" style="text-align:center; font-size:1.05rem; margin-bottom:1.25rem; color:#000;">
        Escribe el nombre del club y presiona <strong>Consultar</strong>.
      </p>

      <form action="{{ url_for('vista_consultar_miembros') }}" method="post" style="margin-top:1rem;">
        <!-- Club (input con datalist) -->
        <div class="form-control" style="margin-bottom:1.25rem;">
          <label for="club_nombre" style="font-weight:600; margin-bottom:.5rem; color:#000;">Club</label>
          <input type="text" name="club_nombre" id="club_nombre" list="sugerencias_clubes"
                 placeholder="Ej.: Club Latino (Moravia)"
                 style="width:100%; padding:.8rem; font-size:1rem; border-radius:8px; border:1px solid #ccc;">
          <input type="hidden" name="club_id" id="club_id">

          <datalist id="sugerencias_clubes">
            {# 'clubs' puede ser dict {id: {nombre, ubicacion?}} o lista de dicts #}
            {% if clubs.items is defined %}
              {% for id, c in clubs.items() %}
                <option value="{{ c.nombre }}{% if c.ubicacion %} ({{ c.ubicacion }}){% endif %}"
                        data-id="{{ id }}">
                  {{ id }} ‚Äî {{ c.nombre }}{% if c.ubicacion %} ({{ c.ubicacion }}){% endif %}
                </option>
              {% endfor %}
            {% else %}
              {% for c in clubs %}
                <option value="{{ c.nombre }}{% if c.ubicacion %} ({{ c.ubicacion }}){% endif %}"
                        data-id="{{ c.id or c.idClub }}">
                  {{ c.id or c.idClub }} ‚Äî {{ c.nombre }}{% if c.ubicacion %} ({{ c.ubicacion }}){% endif %}
                </option>
              {% endfor %}
            {% endif %}
          </datalist>

          <small style="display:block; margin-top:.4rem; color:#000;">
            Usa las sugerencias para seleccionar el club exacto.
          </small>
        </div>

        <!-- Acciones -->
        <div class="actions" style="display:flex; justify-content:flex-end; gap:.8rem; margin-top:1.1rem;">
          <a class="btn btn--secondary" href="{{ url_for('vista_consultas') }}"
             style="text-decoration:none; background:#e0e0e0; color:#000;">‚¨Ö Volver</a>
          <button class="btn btn--primary" type="submit"
                  style="padding:.8rem 1.6rem; font-size:1rem; border-radius:10px;">üîç Consultar</button>
        </div>
      </form>

      {% if miembros is defined %}
        <div class="divider" style="margin:1.4rem 0;"></div>
        <h2>Miembros</h2>

        {% if miembros %}
          <div style="overflow:auto; border:1px solid #ddd; border-radius:10px; background:#fff;">
            <table style="width:100%; border-collapse:collapse;">
              <thead>
                <tr>
                  <th style="text-align:left; padding:.7rem; border-bottom:1px solid #eee;">Nombre</th>
                </tr>
              </thead>
              <tbody>
                {% for m in miembros %}
                  <tr>
                    
                    <td style="padding:.65rem; border-bottom:1px solid #f3f3f3;">
                      {{ m.nombre or m.Nombre }}
                    </td>
                    
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p style="margin-top:.75rem; color:#000;">No se encontraron miembros para ese club.</p>
        {% endif %}
      {% endif %}
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const input = document.getElementById('club_nombre');
      const hidden = document.getElementById('club_id');
      const datalist = document.getElementById('sugerencias_clubes');

      input.addEventListener('input', function () {
        let found = false;
        for (const option of datalist.options) {
          if (option.value === input.value) {
            hidden.value = option.getAttribute('data-id');
            found = true;
            break;
          }
        }
        if (!found) hidden.value = '';
      });
    });
  </script>
  
{% endblock %}
